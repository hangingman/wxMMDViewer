# 実装上の疑問点とメモ

今回の `BasicGLPane` の書き直しにあたり、いくつか設計上の判断や将来的な課題点があります。

1. **頂点の複製 (Vertex Duplication)**
   PMDフォーマットでは材質情報が「面 (Face)」ごとに定義されていますが、OpenGLのシェーダーパイプライン（VBO）では「頂点」ごとに属性を持つ必要があります。
   そのため、今回は頂点を複製して、それぞれの頂点が属する材質の属性（色、エッジフラグなど）を持たせる実装にしました。
   *現状*: シンプルで動作しますが、頂点数が増加しメモリ使用量が増えます。
   *課題*: モデルサイズが巨大になった場合、インデックスバッファを活用したより高度な最適化が必要になる可能性があります。

2. **OpenGLコンテキストの遅延初期化 (Lazy Initialization)**
   wxWidgetsとGLEWの組み合わせにおいて、ウィンドウが表示される前（`IsShown()` が false）に `SetCurrent` や `glewInit` を呼ぶとアサーションエラーが発生しました。
   これを回避するため、`SetPMDData` や `Render` の初回呼び出し時まで初期化を遅延させるフラグ `m_glInitialized` を導入しました。
   *課題*: GUIフレームワークのライフサイクルに依存した解決策です。より堅牢な初期化フロー（例えば `wxGLCanvas` の `EVT_CREATE` イベント利用など）の検討余地があります。

3. **未実装の機能 (Missing Features)**
   参照実装（`mmd-lwjgl`）にあった以下の機能は、今回の書き直しではプレースホルダー（固定値や無効化）としています。
   - **テクスチャマッピング**: UV座標は渡していますが、画像の読み込みとバインド処理は未実装です。
   - **スフィアマップ**: `vSphereMode` は `-1.0f` (無効) で固定しています。
   - **Toonレンダリング**: トゥーンテクスチャの処理は含まれていません。

